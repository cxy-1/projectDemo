package com.sugon.analysis.repository.oracle;import com.sugon.analysis.domain.data.object.oracle.TPersonDo;import com.sugon.analysis.domain.data.object.oracle.TPersonResult;import com.sugon.analysis.domain.data.query.TPersonCountAndAge;import org.springframework.data.jpa.repository.JpaRepository;import org.springframework.data.jpa.repository.Query;import java.util.List;/** * @program: analysis->TPersonDao * @description: * @author: gaowh * @create: 2019-10-10 14:53 **/public interface TPersonDao extends JpaRepository<TPersonDo, Long> {	/**	 * 根据部门ids查询人数与平均年龄	 *	 * @param deptIds	 * @return List<TPersonCountAndAge>	 */	@Query(value = "select AVG(PERSON_AGE) AS ageSum,count(*) AS num from NJGAZNL.T_PERSON where delstatus = '0' and  PCLASSID = '00001' and idno in (select DISTINCT  identitynum from NJGAZNL.SYS_USER t where deptId in(?1) and delstatus = '0' and post_type = '0')", nativeQuery = true)	List<TPersonCountAndAge> findCountByDeptIds(List<String> deptIds);	/**	 * 根据单位查询出来所有的人员并根据职务代码排序	 *	 * @param deptIds	 * @param duty	 * @return int	 */	@Query(value = "select count (*) from (select distinct idno from NJGAZNL.T_PERSON where delstatus = '0' and PCLASSID = '00001' and police_job_grade in (?1) and idno in (select distinct identitynum from NJGAZNL.SYS_USER t where deptId in(?2) and delstatus = '0') order by Police_job_grade)", nativeQuery = true)	int findAllByDeptIdOrderByPoliceJobGrade(List<String> duty, List<String> deptIds);	/**	 * 统计人数和年龄总和	 *	 * @return List<TPersonCountAndAge>	 */	@Query(value = "select SUM(PERSON_AGE) AS ageSum,count(*) AS num from NJGAZNL.T_PERSON WHERE DELSTATUS='0' AND PCLASSID='00001'", nativeQuery = true)	List<TPersonCountAndAge> findCountAll();	/**	 * 统计指定职位的人数	 *	 * @param duty	 * @return int	 */	@Query(value = "select count(*) from NJGAZNL.T_PERSON where DELSTATUS='0' AND PCLASSID='00001' AND police_job_grade in (?1) order by Police_job_grade", nativeQuery = true)	int findAllPoliceJobGrade(List<String> duty);	/**	 * 查询市局所有的人员	 *	 * @param delStatus	 * @return List<TPersonDo>	 */	List<TPersonDo> findAllByDelStatusAndPClassId(String delStatus, String classId);	/**	 * 查询市局所有的人员ID	 *	 * @param delStatus	 * @return List<TPersonDo>	 */	@Query(value = "select idno from NJGAZNL.T_PERSON where DELSTATUS=?1 AND PCLASSID=?2", nativeQuery = true)	List<String> findAllIdsByDelStatus(String delStatus, String pClassId);	/**	 * 根据身份证号统计年龄	 *	 * @param idNumber	 * @param delStatus	 * @return List<TPersonResult>	 */	@Query(value = "SELECT PERSON_AGE AS BIRTHDAY ,count(*) AS num  from NJGAZNL.t_person  WHERE IDNO IN (?1) AND DELSTATUS = ?2 AND PCLASSID='00001'AND PERSON_AGE IS NOT NULL group by PERSON_AGE", nativeQuery = true)	List<TPersonResult> getAgesByIdNumber(List<String> idNumber, String delStatus);	/**	 * 根据身份证号查询	 *	 * @param delStatus	 * @param idNos	 * @return List<TPersonDo>	 */	List<TPersonDo> findAllByDelStatusAndIdNoIn(String delStatus, List<String> idNos);	/**	 * 根据用户的身份证号查询用户最大的年龄	 *	 * @param idNos	 * @return List<TPersonDo>	 */	@Query(value = "select * from NJGAZNL.t_person where PERSON_AGE is not null and delstatus = '0' AND PCLASSID='00001' and idno in(?1) order by PERSON_AGE desc ", nativeQuery = true)	List<TPersonDo> findMaxAgePeoPle(List<String> idNos);	/**	 * 根据idNo查询人员信息	 *	 * @param idNo	 * @param delStatus	 * @return TPersonDo	 */	@Query(value = "select * from NJGAZNL.t_person where idNo = ?1 and delstatus = ?2 and PCLASSID = '00001'", nativeQuery = true)	TPersonDo findByIdNoAndDelStatus(String idNo, String delStatus);	@Query(value = "select * from NJGAZNL.t_person where idNo = ?1 and delstatus = ?2 and PCLASSID = '00001' and POLICE_NO is not null ", nativeQuery = true)	TPersonDo findByIdNoAndDelStatusAndPoliceNo(String idNo, String delStatus);	/**	 * 获取市局所有在职人员	 *	 * @return	 */	@Query(value = "select distinct * from NJGAZNL.T_PERSON T3 WHERE EXISTS (SELECT distinct T2.IDENTITYNUM FROM NJGAZNL.SYS_USER T2 WHERE  T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE = '0' ) AND DELSTATUS ='0' AND PCLASSID='00001'", nativeQuery = true)	List<TPersonDo> findAllByDelStatusAndPoliceNoIsNotNullAndPClassId();	/**	 * 获取市局所有在职人员	 *	 * @return	 */	@Query(value = "select distinct IDNO from NJGAZNL.T_PERSON T3 WHERE EXISTS (SELECT distinct T2.IDENTITYNUM FROM NJGAZNL.SYS_USER T2 WHERE  T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE = '0' ) AND DELSTATUS ='0' AND PCLASSID='00001'", nativeQuery = true)	List<String> findAllIdNosByDelStatusAndPoliceNoIsNotNullAndPClassId();	/**	 * 查询最长的工作时间	 *	 * @param idNos	 * @return	 */	@Query(value = "select * from NJGAZNL.t_person where delstatus = '0' AND PCLASSID='00001' and idno in(?1) order by time_to_work_psb asc ", nativeQuery = true)	List<TPersonDo> findMaxAgeTimeWork(List<String> idNos);	/**	 * 根据职务查询	 *	 * @param delStatus	 * @param dutys	 * @return	 */	List<TPersonDo> findAllByDelStatusAndPoliceJobGradeIn(String delStatus, List<String> dutys);	/**	 * 根据职级查询	 *	 * @param delStatus	 * @param dutyRank	 * @return	 */	List<TPersonDo> findAllByDelStatusAndJobGrade(String delStatus, String dutyRank);	/**	 * 根据警衔查询	 *	 * @param delStatus	 * @param policeRank	 * @return	 */	List<TPersonDo> findAllByDelStatusAndPoliceRank(String delStatus, String policeRank);	/**	 * @param code	 * @return	 */	@Query(value = "SELECT idNo from(SELECT ROW_NUMBER() OVER(PARTITION BY IDNO ORDER BY TO_NUMBER(SUBSTR(DATA_SOURCE_ID,12,13)) DESC) rn,NJGAZNL.T_EDUCATION_INFO.* FROM NJGAZNL.T_EDUCATION_INFO) where rn  = '1' and educational_title in (?1)", nativeQuery = true)	List<String> findAllBycodeIn(List<String> code);	List<TPersonDo> findAllByDelStatusAndSourceIn(String delStatus, List<String> source);	/**	 * 根据部门ids 查询人员	 *	 * @param deptIds	 * @return	 */	@Query(value = "select distinct * from NJGAZNL.T_PERSON T3 WHERE EXISTS (SELECT distinct T2.IDENTITYNUM FROM NJGAZNL.SYS_USER T2, NJGAZNL.SYS_DEPT T1 WHERE deptId IN (?1) AND T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE = '0' AND T1.ID = T2.DEPTID) AND DELSTATUS ='0' AND PCLASSID='00001'", nativeQuery = true)	List<TPersonDo> findAllBydeptIdIn(List<String> deptIds);	/**	 * 根据部门ids 查询人员身份证号码	 *	 * @param deptIds	 * @return	 */	@Query(value = "select distinct idno from NJGAZNL.T_PERSON T3 WHERE EXISTS (SELECT distinct T2.IDENTITYNUM FROM NJGAZNL.SYS_USER T2, NJGAZNL.SYS_DEPT T1 WHERE deptId IN (?1) AND T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE = '0' AND T1.ID = T2.DEPTID) AND DELSTATUS ='0' AND PCLASSID='00001'", nativeQuery = true)	List<String> findIdNosBydeptIdIn(List<String> deptIds);	List<TPersonDo> findAllByIdNoIn(List<String> idNos);	/**	 * 查询来源是其它的人员	 *	 * @param delStatus	 * @param source	 * @param idNos	 * @return	 */	List<TPersonDo> findAllByDelStatusAndSourceNotInAndIdNoIn(String delStatus, List<String> source, List<String> idNos);	@Query(value = "SELECT * FROM NJGAZNL.T_PERSON T3 WHERE " +			"EXISTS (SELECT T2.IDENTITYNUM FROM NJGAZNL.SYS_USER T2, NJGAZNL.SYS_DEPT T1 WHERE deptId IN (?1) AND T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE = '0' AND T1.ID = T2.DEPTID) " +			"AND PERSON_AGE >= ?2 AND PERSON_AGE <= ?3 AND DELSTATUS ='0' AND PCLASSID='00001' ORDER BY ORG_ID ASC ", nativeQuery = true)	List<TPersonDo> findAgeByIdNo(List<String> code, String start, String end);	/**	 * @param education	 * @param delStatus	 * @param unitCode	 * @return	 * @学历学位和unitcode查询	 */	@Query(value = "SELECT * FROM NJGAZNL.T_PERSON WHERE DELSTATUS ='0' AND PCLASSID='00001' AND IDNO IN(SELECT T.IDNO FROM (SELECT IDNO FROM (SELECT ROW_NUMBER() OVER(PARTITION BY IDNO ORDER BY TO_NUMBER(SUBSTR(DATA_SOURCE_ID,12,13))  DESC) rn,NJGAZNL.T_EDUCATION_INFO.* FROM NJGAZNL.T_EDUCATION_INFO) WHERE rn = 1 AND EDUCATIONAL_TITLE IN(?1) AND DELSTATUS =?2 AND idno in (SELECT T2.IDENTITYNUM as idno FROM NJGAZNL.SYS_USER T2, NJGAZNL.SYS_DEPT T1,NJGAZNL.T_PERSON T3 WHERE T2.deptId IN (?3) AND T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE='0' AND T1.ID = T2.DEPTID)) T)", nativeQuery = true)	List<TPersonDo> getEducationFirstByeducationFlag(List<String> education, String delStatus, List<String> unitCode);	@Query(value = "SELECT * from NJGAZNL.T_PERSON where DELSTATUS ='0' AND PCLASSID='00001' AND idNo in(SELECT idNo from(SELECT idNo,TRUNC(months_between(sysdate, time_to_work_psb)/12) AS work_age FROM NJGAZNL.T_PERSON T3 WHERE EXISTS (SELECT T2.IDENTITYNUM FROM NJGAZNL.SYS_USER T2, NJGAZNL.SYS_DEPT T1 WHERE deptId IN (?1) AND T2.IDENTITYNUM = T3.IDNO AND T2.DELSTATUS = '0' AND T2.POST_TYPE = '0' AND T1.ID = T2.DEPTID)  AND DELSTATUS ='0' and PCLASSID = '00001' ORDER BY ORG_ID ASC) where work_age >=?2 and work_age <=?3) ", nativeQuery = true)	List<TPersonDo> findPersonByDeptIdsAndworkAge(List<String> deptIds, String start, String end);	@Query(value = "SELECT * FROM NJGAZNL.T_PERSON WHERE DELSTATUS ='0' AND PCLASSID='00001' AND IDNO IN(SELECT idNo FROM(SELECT *from NJGAZNL.T_PERSON where delstatus = '0' AND IDNO IN(select identitynum from NJGAZNL.SYS_USER where deptId in(?1) and delstatus ='0' and post_type = '0')) T1 LEFT JOIN NJGAZNL.SG_QUERY_CATEGORY T2 ON T1.MARITAL_STATUS = T2.CVFLAG WHERE T2.CVTYPE ='BG' and T2.CVNAME = ?2)", nativeQuery = true)	List<TPersonDo> findPersonByDeptIdsAndMarriayType(List<String> deptIds, String type);	@Query(value = "SELECT * FROM NJGAZNL.T_PERSON where delstatus ='0' and PCLASSID = '00001' and idNo in(?1) ", nativeQuery = true)	List<TPersonDo> findAllByDelStatusAndPClassIdAndIdNoIn(List<String> idNos);}