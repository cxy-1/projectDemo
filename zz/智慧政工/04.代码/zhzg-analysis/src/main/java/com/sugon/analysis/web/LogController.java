package com.sugon.analysis.web;import com.sugon.analysis.domain.data.object.sugon.oracle.UserLog;import com.sugon.analysis.domain.data.query.LogQuery;import com.sugon.analysis.enums.result.ResultModel;import com.sugon.analysis.repository.sugon.oracle.UserLogDao;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Value;import org.springframework.jdbc.core.JdbcTemplate;import org.springframework.web.bind.annotation.*;import javax.annotation.Resource;import java.util.List;import java.util.Map;/** * @author: create by huangxb * @version: v1.0 * @description: * @date:2019/12/24 */@RestController@RequestMapping("/log")@Slf4jpublic class LogController {    @Resource    private UserLogDao userLogDao;    @Value("${spring.profiles.active}")    private String active;    @Resource(name = "primaryJdbcTemplate")    private JdbcTemplate primaryJdbcTemplate;    @CrossOrigin    @RequestMapping(value = "/getPersonLog", method = RequestMethod.POST)    public ResultModel getPersonLog(@RequestBody LogQuery logQuery) {        ResultModel resultModel = new ResultModel();        if(logQuery != null) {            //获取当前时间            List<Map<String,Object>> userLogs = primaryJdbcTemplate.queryForList("SELECT PERSON_NAME,ORG_SIMPLE_NAME,OFFICE_SIMPLE_NAME,POLICE_NO,UNITID,DEPTID FROM NJGAZNL.T_PERSON T1 LEFT JOIN NJGAZNL.SYS_USER T2 ON T1.IDNO=T2.IDENTITYNUM WHERE IDNO='" + logQuery.getIdNumber() + "'");            if(userLogs.size()>0){                Map<String,Object>  map = userLogs.get(0);                UserLog userLog = new UserLog();                userLog.setIdNo(logQuery.getIdNumber());                userLog.setFlagName(logQuery.getFlagName());                userLog.setPageName(logQuery.getPageName());                userLog.setCreateTime(new java.sql.Timestamp(System.currentTimeMillis()));                userLog.setPersonName(map.get("PERSON_NAME")!=null?String.valueOf(map.get("PERSON_NAME")):"");                userLog.setOrgSimpleName(map.get("ORG_SIMPLE_NAME")!=null?String.valueOf(map.get("ORG_SIMPLE_NAME")):"");                userLog.setOfficeSimpleName(map.get("OFFICE_SIMPLE_NAME")!=null?String.valueOf(map.get("OFFICE_SIMPLE_NAME")):"");                userLog.setPoliceNo(map.get("POLICE_NO")!=null?String.valueOf(map.get("POLICE_NO")):"");                userLog.setUnitId(map.get("UNITID")!=null?String.valueOf(map.get("UNITID")):"");                userLog.setDeptId(map.get("DEPTID")!=null?String.valueOf(map.get("DEPTID")):"");                userLog.setActive(active);                userLog.setAction(logQuery.getAction());                resultModel.setResult(userLogDao.save(userLog));            }else{                resultModel.setResult("用户不存在");            }        }else {            resultModel.setResult("无效参数");        }        return resultModel;    }}