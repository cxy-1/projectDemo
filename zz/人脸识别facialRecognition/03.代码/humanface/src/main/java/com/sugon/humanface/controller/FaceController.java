package com.sugon.humanface.controller;import java.math.BigDecimal;import java.util.HashMap;import java.util.Map;import javax.annotation.Resource;import javax.servlet.http.HttpServletRequest;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.bind.annotation.RestController;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import com.sugon.humanface.service.FaceSearchService;import com.sugon.humanface.service.FaceService;import com.sugon.humanface.utils.JsonUtil;@RestController@RequestMapping("/face")public class FaceController {    @Resource    private FaceService FaceService;    @ResponseBody    @RequestMapping("/face")    public String test(HttpServletRequest request) {        String result = null;        String imgContent = request.getParameter("imgContent");        String json = FaceSearchService.search(imgContent);        Map<String,String> resultMap = new HashMap<String,String>();        Map map = JsonUtil.jsonToMap(json);        if(null != map && map.size() > 0) {            if(null != map.get("result")) {                JSONObject s = (JSONObject) map.get("result");                Integer errorCode = (Integer)map.get("error_code");                String error_msg = (String)map.get("error_msg");                if(0 == errorCode && "SUCCESS".equals(error_msg)) {                    JSONArray st = (JSONArray) s.get("user_list");                    JSONObject js = (JSONObject)(st.get(0));                    String userid = (String)js.get("user_id");                    BigDecimal score = (BigDecimal)js.get("score");                    double d = score.doubleValue();                    if(d > 75) {                        System.out.println("error_code"+ map.get("error_code"));                        System.out.println("user_id"+js.get("user_id"));                        System.out.println("score"+js.get("score"));                        result = FaceService.getUserInfo(userid);                    }else {                        resultMap.put("key", "人脸识别失败");                        result = JsonUtil.mapToJson(resultMap);                    }                }else {                    resultMap.put("key", "人脸识别失败");                    result = JsonUtil.mapToJson(resultMap);                }            }else {                resultMap.put("key", "人脸识别失败");                result = JsonUtil.mapToJson(resultMap);            }        }else{            resultMap.put("key", "人脸识别失败");            result = JsonUtil.mapToJson(resultMap);        }        return result;    }    /**     * 获取用户累计访问次数     * @param request     * @return     */    @ResponseBody    @RequestMapping("/getFaceCount")    public String getFaceCount(HttpServletRequest request) {        return String.valueOf(FaceService.getFaceCount());    }}